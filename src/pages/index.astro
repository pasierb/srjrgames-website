---
import { getCollection } from "astro:content";
import Hero from "../components/Hero.astro";
import Layout from "../layouts/Layout.astro";
import BlogCard from "../components/BlogCard.astro";
import KofiWidget from "../components/KofiWidget.astro";

const posts = await getCollection("blog");
const latestPost = posts.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
)[0];

const formattedPost = latestPost
	? {
			title: latestPost.data.title,
			description: latestPost.data.description,
			date: latestPost.data.pubDate.toLocaleDateString("en-US", {
				year: "numeric",
				month: "short",
				day: "numeric",
			}),
			author: latestPost.data.author,
			image: latestPost.data.image,
			url: `/blog/${latestPost.id}`,
		}
	: null;
---

<Layout
	title="Sr. Jr. Games | Making games, learning together"
	description="Welcome to Sr. Jr. Games, where a father and son build games and explore technology together. Discover our projects and learning resources."
>
	<Hero />

	{
		formattedPost && (
			<section class="latest-article">
				<div class="container">
					<header class="section-header">
						<div class="header-content">
							<span class="badge">New Release</span>
							<h2>
								Latest from the{" "}
								<span class="highlight">Blog</span>
							</h2>
						</div>
						<a href="/blog" class="view-all">
							View all posts
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="20"
								height="20"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<path d="M5 12h14m-7-7 7 7-7 7" />
							</svg>
						</a>
					</header>
					<div class="article-wrapper">
						<BlogCard {...formattedPost} />
					</div>
				</div>
			</section>
		)
	}

	<KofiWidget />
</Layout>

<style>
	.latest-article {
		padding: 8rem 0;
		background: var(--color-white);
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 2rem;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
		margin-bottom: 4rem;
	}

	.badge {
		display: inline-block;
		background: var(--color-navy);
		color: var(--color-white);
		padding: 0.4rem 1rem;
		border-radius: var(--radius-sm);
		font-size: 0.9rem;
		font-weight: 600;
		margin-bottom: 1rem;
	}

	h2 {
		font-size: 3rem;
		line-height: 1.1;
	}

	.highlight {
		color: var(--color-red);
		background: linear-gradient(
			180deg,
			transparent 70%,
			var(--color-yellow) 70%
		);
	}

	.view-all {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-weight: 800;
		color: var(--color-navy);
		font-family: var(--font-accent);
		text-decoration: none;
		transition: gap 0.2s ease;
		padding-bottom: 0.5rem;
	}

	.view-all:hover {
		gap: 0.75rem;
		color: var(--color-red);
	}

	.article-wrapper {
		max-width: 800px;
	}

	@media (max-width: 768px) {
		.latest-article {
			padding: 4rem 0;
		}

		.section-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 1.5rem;
			margin-bottom: 3rem;
		}

		h2 {
			font-size: 2.5rem;
		}
	}
</style>
