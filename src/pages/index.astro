---
import { getCollection } from "astro:content";
import Hero from "../components/Hero.astro";
import Layout from "../layouts/Layout.astro";
import BlogCard from "../components/BlogCard.astro";
import KofiWidget from "../components/KofiWidget.astro";

const posts = await getCollection("blog");
const sortedPosts = posts.sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const latestPost = sortedPosts[0];
const otherPosts = sortedPosts.slice(1, 4);

const formattedLatestPost = latestPost
	? {
			title: latestPost.data.title,
			description: latestPost.data.description,
			date: latestPost.data.pubDate.toLocaleDateString("en-US", {
				year: "numeric",
				month: "short",
				day: "numeric",
			}),
			author: latestPost.data.author,
			image: latestPost.data.image,
			url: `/blog/${latestPost.id}`,
		}
	: null;

const formattedOtherPosts = otherPosts.map((post) => ({
	title: post.data.title,
	date: post.data.pubDate.toLocaleDateString("en-US", {
		year: "numeric",
		month: "short",
		day: "numeric",
	}),
	url: `/blog/${post.id}`,
}));
---

<Layout
	title="Sr. Jr. Games | Making games, learning together"
	description="Welcome to Sr. Jr. Games, where a father and son build games and explore technology together. Discover our projects and learning resources."
>
	<Hero />

	{
		formattedLatestPost && (
			<section class="latest-article">
				<div class="container">
					<header class="section-header">
						<div class="header-content">
							<span class="badge">New Release</span>
							<h2>
								Latest from the{" "}
								<span class="highlight">Blog</span>
							</h2>
						</div>
						<a href="/blog" class="view-all">
							View all posts
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="20"
								height="20"
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
							>
								<path d="M5 12h14m-7-7 7 7-7 7" />
							</svg>
						</a>
					</header>

					<div class="blog-grid">
						<div class="article-wrapper">
							<BlogCard {...formattedLatestPost} />
						</div>

						{formattedOtherPosts.length > 0 && (
							<div class="more-posts">
								<h3>More from the blog</h3>
								<div class="posts-list">
									{formattedOtherPosts.map((post) => (
										<a href={post.url} class="post-item">
											<div class="post-item-content">
												<span class="post-date">
													{post.date}
												</span>
												<span class="post-title">
													{post.title}
												</span>
											</div>
											<svg
												xmlns="http://www.w3.org/2000/svg"
												width="24"
												height="24"
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
											>
												<path d="M5 12h14m-7-7 7 7-7 7" />
											</svg>
										</a>
									))}
								</div>
							</div>
						)}
					</div>
				</div>
			</section>
		)
	}

	<KofiWidget />
</Layout>

<style>
	.latest-article {
		padding: 8rem 0;
		background: var(--color-white);
	}

	.container {
		max-width: 1200px;
		margin: 0 auto;
		padding: 0 2rem;
	}

	.section-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
		margin-bottom: 4rem;
	}

	.badge {
		display: inline-block;
		background: var(--color-navy);
		color: var(--color-white);
		padding: 0.4rem 1rem;
		border-radius: var(--radius-sm);
		font-size: 0.9rem;
		font-weight: 600;
		margin-bottom: 1rem;
	}

	h2 {
		font-size: 3rem;
		line-height: 1.1;
	}

	.highlight {
		color: var(--color-red);
		background: linear-gradient(
			180deg,
			transparent 70%,
			var(--color-yellow) 70%
		);
	}

	.view-all {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-weight: 800;
		color: var(--color-navy);
		font-family: var(--font-accent);
		text-decoration: none;
		transition: gap 0.2s ease;
		padding-bottom: 0.5rem;
	}

	.view-all:hover {
		gap: 0.75rem;
		color: var(--color-red);
	}

	.article-wrapper {
		flex: 1;
		min-width: 0;
	}

	.blog-grid {
		display: grid;
		grid-template-columns: 1.6fr 1fr;
		gap: 3rem;
		align-items: flex-start;
	}

	.more-posts {
		display: flex;
		flex-direction: column;
		gap: 1.5rem;
	}

	.more-posts h3 {
		font-size: 1.5rem;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: var(--color-navy);
		padding-bottom: 0.5rem;
		border-bottom: 3px solid var(--color-navy);
	}

	.posts-list {
		display: flex;
		flex-direction: column;
		gap: 1rem;
	}

	.post-item {
		display: flex;
		justify-content: space-between;
		align-items: center;
		padding: 1.25rem;
		background: var(--color-white);
		border: 3px solid var(--color-navy);
		border-radius: var(--radius-md);
		text-decoration: none;
		color: var(--color-navy);
		transition: all 0.2s ease;
		box-shadow: 4px 4px 0 var(--color-navy);
	}

	.post-item:hover {
		transform: translate(-2px, -2px);
		box-shadow: 6px 6px 0 var(--color-navy);
		color: var(--color-red);
	}

	.post-item-content {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
	}

	.post-date {
		font-size: 0.8rem;
		font-weight: 700;
		text-transform: uppercase;
		opacity: 0.7;
	}

	.post-title {
		font-size: 1.1rem;
		font-weight: 800;
		line-height: 1.2;
	}

	.post-item svg {
		flex-shrink: 0;
		transition: transform 0.2s ease;
	}

	.post-item:hover svg {
		transform: translateX(4px);
	}

	@media (max-width: 1024px) {
		.blog-grid {
			grid-template-columns: 1fr;
			gap: 4rem;
		}
	}

	@media (max-width: 768px) {
		.latest-article {
			padding: 4rem 0;
		}

		.section-header {
			flex-direction: column;
			align-items: flex-start;
			gap: 1.5rem;
			margin-bottom: 3rem;
		}

		h2 {
			font-size: 2.5rem;
		}
	}
</style>
